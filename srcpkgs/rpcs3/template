# Template file for 'rpcs3'
pkgname=rpcs3
version=0.0.14
revision=1
_asmjit_commit=fc251c914e77cd079e58982cdab00a47539d7fc5
_llvm_commit=cb7748dfa0d615e9f5ea9f31e0ce40fe9aeac595
_glslang_commit=3ee5f2f1d3316e228916788b300d786bb574d337
_spirv_tools_commit=895927bd3f2d653f40cebab55aa6c7eabde30a86
_spirv_headers_commit=3fdabd0da2932c276b25b9b4a988ba134eba1aa6
_cereal_commit=60c69df968d1c72c998cd5f23ba34e2e3718a84b
_zlib_commit=cacf7f1d4e3d44d871b605da3b647f07d718623f
_hidapi_commit=8961cf86ebc4756992a7cd65c219c743e94bab19
_pugixml_commit=8bf806c035373bd0723a85c0820cfd5c804bf6cd
_xxHash_commit=94e5f23e736f2bb67ebdf90727353e65344f9fc0
_yaml_cpp_commit=6a211f0bc71920beef749e6c35d7d1bcc2447715
_libpng_commit=eddf9023206dc40974c26f589ee2ad63a4227a1e
_libusb_commit=c33990a300674e24f47ff0f172f7efb10b63b88a
_FAudio_commit=9c7d2d1430c9dbe4e67c871dfe003b331f165412
_span_commit=9d7559aabdebf569cab3480a7ea2a87948c0ae47
_curl_commit=9d954e49bce3706a9a2efb119ecd05767f0f2a9e
_wolfssl_commit=39b5448601271b8d1deabde8a0d33dc64d2a94bd
archs="x86_64*" # The build system (and probably some code) assumes x86_64
build_style=cmake
configure_args="-DUSE_SYSTEM_FFMPEG=ON -DUSE_SYS_LIBUSB=ON -DUSE_SYSTEM_CURL=ON"
hostmakedepends="python3 pkg-config"
makedepends="zlib-devel qt5-devel Vulkan-Headers SDL2-devel libopenal-devel
 flatbuffers-devel glew-devel libatomic-devel ffmpeg-devel libcurl-devel"
short_desc="PS3 emulator"
maintainer="John <me@johnnynator.dev>"
license="GPL-3.0-or-later"
homepage="https://rpcs3.net/"
distfiles="https://github.com/RPCS3/rpcs3/archive/v${version}.tar.gz
 https://github.com/kobalicek/asmjit/archive/${_asmjit_commit}.tar.gz
 https://github.com/RPCS3/llvm-mirror/archive/${_llvm_commit}.tar.gz
 https://github.com/KhronosGroup/glslang/archive/${_glslang_commit}.tar.gz
 https://github.com/KhronosGroup/SPIRV-Tools/archive/${_spirv_tools_commit}.tar.gz
 https://github.com/KhronosGroup/SPIRV-Headers/archive/${_spirv_headers_commit}.tar.gz
 https://github.com/RPCS3/cereal/archive/${_cereal_commit}.tar.gz
 https://github.com/madler/zlib/archive/${_zlib_commit}.tar.gz
 https://github.com/RPCS3/hidapi/archive/${_hidapi_commit}.tar.gz
 https://github.com/zeux/pugixml/archive/${_pugixml_commit}.tar.gz
 https://github.com/Cyan4973/xxHash/archive/${_xxHash_commit}.tar.gz
 https://github.com/RPCS3/yaml-cpp/archive/${_yaml_cpp_commit}.tar.gz
 https://github.com/glennrp/libpng/archive/${_libpng_commit}.tar.gz
 https://github.com/libusb/libusb/archive/${_libusb_commit}.tar.gz
 https://github.com/FNA-XNA/FAudio/archive/${_FAudio_commit}.tar.gz
 https://github.com/tcbrindle/span/archive/${_span_commit}.tar.gz
 https://github.com/RipleyTom/wolfssl/archive/${_wolfssl_commit}.tar.gz"
checksum="0734bdb5090605431bfc3e3c082ba1b889507c14c31b2233630f437bee718abc
 fc804065cedaa0c6432df62c6effbf1c387907faf089e82794dd6d5429d6c51f
 83fa28423d91d29a9fa28f646fb3482c8b437b492e54d433c9df23e3d18e0c65
 7b2f8b93958c7594942f730659c00dec0bffeafaa6853b67b5f72f915c287b1f
 4327ea5a7e98979061bd229ff87763d5963acf696e145c5b99b0b3e5cb425d5e
 61874b108c90ba17e7cde74b92a40bf1cf6ce6d66a30c5ea932e9cfb5df94dc4
 aa4da10c5d292de73275e1f8b9390ecc519aaccd4debcd642de79689c246b326
 6d4d6640ca3121620995ee255945161821218752b551a1a180f4215f7d124d45
 91dd6ef92b85a39a4f5ec066af093ec4b8c7b8a68fa49b638c070cf8a9778402
 c2a717088b6377fff8c28b31f25fdf30dee78ea4b5c5261c884416fac63536b9
 3de01e4f8c60d84907a2ce65b6528be999c0a9331be719ae3671102d0e1a5ccc
 fe37ffdc4c91e943976c9abae9c0f9153911de68173dc8b9fd36447cf52e3fbb
 b1484ff1ae3711084b6dd8a880d0e560fa1c5f6d1c5a87a04a207c4bc3d315af
 9ab97e37c336d249e9c717d0bb07b659269f1ce211028057953b3c4af2b12c7c
 02b1e07e85f578cb145a8a3dd14ce53ee0816744d71183f4b8a6090a5b194ed3
 86abe8635bdf555b948d318544b0595ef0c2e710e85f885b581f3ae08fb7e38c
 cf79863e8dbffe5db5cad531297a2ae84925c108e1a34a6fd178a0432721fa25"
nopie=yes

post_extract() {
	rmdir -v ${wrksrc}/asmjit
	mv ${wrksrc}/../asmjit-${_asmjit_commit} ${wrksrc}/asmjit
	rmdir -v ${wrksrc}/llvm
	mv ${wrksrc}/../llvm-mirror-${_llvm_commit} ${wrksrc}/llvm
	rmdir -v ${wrksrc}/Vulkan/glslang
	mv ${wrksrc}/../glslang-${_glslang_commit} ${wrksrc}/Vulkan/glslang
	rmdir -v ${wrksrc}/Vulkan/spirv-tools
	mv ${wrksrc}/../SPIRV-Tools-${_spirv_tools_commit} ${wrksrc}/Vulkan/spirv-tools
	rmdir -v ${wrksrc}/Vulkan/spirv-headers
	mv ${wrksrc}/../SPIRV-Headers-${_spirv_headers_commit} ${wrksrc}/Vulkan/spirv-headers
	rmdir -v ${wrksrc}/3rdparty/cereal
	mv ${wrksrc}/../cereal-${_cereal_commit} ${wrksrc}/3rdparty/cereal
	rmdir -v ${wrksrc}/3rdparty/zlib
	mv ${wrksrc}/../zlib-${_zlib_commit} ${wrksrc}/3rdparty/zlib
	rmdir -v ${wrksrc}/3rdparty/hidapi
	mv ${wrksrc}/../hidapi-${_hidapi_commit} ${wrksrc}/3rdparty/hidapi
	rmdir -v ${wrksrc}/3rdparty/pugixml
	mv ${wrksrc}/../pugixml-${_pugixml_commit} ${wrksrc}/3rdparty/pugixml
	rmdir -v ${wrksrc}/3rdparty/xxHash
	mv ${wrksrc}/../xxHash-${_xxHash_commit} ${wrksrc}/3rdparty/xxHash
	rmdir -v ${wrksrc}/3rdparty/yaml-cpp
	mv ${wrksrc}/../yaml-cpp-${_yaml_cpp_commit} ${wrksrc}/3rdparty/yaml-cpp
	rmdir -v ${wrksrc}/3rdparty/libpng
	mv ${wrksrc}/../libpng-${_libpng_commit} ${wrksrc}/3rdparty/libpng
	rmdir -v ${wrksrc}/3rdparty/libusb
	mv ${wrksrc}/../libusb-${_libusb_commit} ${wrksrc}/3rdparty/libusb
	rmdir -v ${wrksrc}/3rdparty/FAudio
	mv ${wrksrc}/../FAudio-${_FAudio_commit} ${wrksrc}/3rdparty/FAudio
	rmdir -v ${wrksrc}/3rdparty/span
	mv ${wrksrc}/../span-${_span_commit} ${wrksrc}/3rdparty/span
	rmdir -v ${wrksrc}/3rdparty/wolfssl
	mv ${wrksrc}/../wolfssl-${_wolfssl_commit} ${wrksrc}/3rdparty/wolfssl
}
